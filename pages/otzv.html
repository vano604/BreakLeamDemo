<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="../css/styles.css">
<link rel="icon" type="image/png" href="../images/BreakLeam.jpg">
<title>BreakLeam / –û—Ç–∑—ã–≤—ã</title>
</head>
<body>

    <body>
        <header>
            
            <div onclick="window.location.href='index.html'"><img class="header-logo" height="100px" src="../images/BreakLeam.jpg" alt="Logo"></div>
            <nav id="navbar" class="nav">
                <div class="nav-links"><a href="../index.html">–ì–ª–∞–≤–Ω–∞—è</a></div>
                <div class="nav-links"><a href="info.html">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</a></div>
                <div class="nav-links"><a href="yt.html">–Æ—Ç—É–±–µ—Ä—ã</a></div>
                <div class="nav-links"><a href="rules.html">–ü—Ä–∞–≤–∏–ª–∞</a></div>
                <div class="nav-links"><a href="otzv.html" class="active">–û—Ç–∑—ã–≤—ã</a></div>
            </nav>
    
            <a class="hamburger-menu" onclick="mobileMenu()"><i class="fa fa-bars"></i></a>
        
        </header>
    
        <main>
            <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
<div id="registerBox" class="form-box">
<h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
<input type="text" id="regUsername" placeholder="–í–∞—à–µ –∏–º—è"><br>
<input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å"><br>
<input type="password" id="regPassword2" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"><br>
<input type="file" id="regAvatar" accept="image/*"><br>
<button onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
<p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showLoginBox()">–í–æ–π—Ç–∏</a></p>
</div>

<!-- –í—Ö–æ–¥ -->
<div id="loginBox" class="form-box" style="display:none;">
<h2>–í—Ö–æ–¥</h2>
<input type="text" id="loginUsername" placeholder="–í–∞—à–µ –∏–º—è"><br>
<input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å"><br>
<button onclick="loginUser()">–í–æ–π—Ç–∏</button>
<p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterBox()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
</div>

<!-- –§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–æ–≤ -->
<div id="reviewBox" class="form-box" style="display:none;">
<h2>–ü—Ä–∏–≤–µ—Ç, <span id="userDisplay"></span> <img id="userAvatar" src="" width="40" style="border-radius:50%; vertical-align:middle;"></h2>
<button onclick="logoutUser()">–í—ã–π—Ç–∏</button><br><br>
<button type="button" onclick="toggleMail()">–ü–∏—Å—å–º–∞</button>

<textarea id="reviewInput" placeholder="–í–∞—à –æ—Ç–∑—ã–≤"></textarea>
<button onclick="addReview()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
<div id="mailBox" style="display:none; margin-top:15px;">
    <h3>–ü–∏—Å—å–º–∞ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</h3>
    
    <div id="mailList"></div>
    
    <div id="adminMailForm" style="margin-top:10px;">
        <input type="text" id="mailTo" placeholder="–ö–æ–º—É (–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)">
        <textarea id="mailInput" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"></textarea>
        <button onclick="sendMail()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ</button>
        </div>
    </div>    
</div>

<h2>–û—Ç–∑—ã–≤—ã</h2>
<div id="reviewsList"></div>
        </main>
    
        <footer>
            <div class="row">
                <div class="col-5">
                    <div class="centered footer-info">
                        <span>–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. &copy;</span>
                        <span id="an"> </span>
                    </div>
                </div>
                <div class="col-5 centered">
                    <h3>–ù–∞—à–∏ —Å–æ—Ü—Å–µ—Ç–∏</h3>
                    <a href="https://t.me/BreakLeam" target="_blank"><img src="../images/tg.png" alt="Telegram" class="social"></a>
                    <a href="https://t.me/BreakLeam_bot" target="_blank"><img src="../images/tgbot.png" alt="TelegramBot" class="socialb"></a>
                    <a href="https://discord.gg/MYZCfp48" target="_blank"><img src="../images/discord.png" alt="Discord" class="social"></a>
                </div>
            </div>
    
        </footer>
    
        <script src="../js/js.js"></script>
    
    </body>

<div class="container">



<script>
// ---- 1. –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ –∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ----
// –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∑–∞–¥–∞—ë–º –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ
let predefinedUsers = [
    {name:"Vanovich667_ADM", password:"15fev1215fev12", avatar:"https://static.vecteezy.com/system/resources/thumbnails/019/194/935/small_2x/global-admin-icon-color-outline-vector.jpg", role:"admin"},
    {name:"Lank32123_ADM", password:"Lankadmin12gs2", avatar:"https://static.vecteezy.com/system/resources/thumbnails/019/194/935/small_2x/global-admin-icon-color-outline-vector.jpg", role:"admin"}
];

// ---- 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ----
let users = JSON.parse(localStorage.getItem('users') || "[]");
for(let u of predefinedUsers){
    if(!users.some(user => user.name === u.name)){
        users.push(u);
    }
}
localStorage.setItem('users', JSON.stringify(users));

let currentUser = JSON.parse(localStorage.getItem('currentUser') || "null");

// ---- 3. –ü–ª–æ—Ö–∏–µ —Å–ª–æ–≤–∞ ----
const BAD_WORDS = [
    "—Ö—É–π",
    "–ø–∏–∑–¥–∞"

];

// ---- 4. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ—Ä–º ----
function showLoginBox(){
    document.getElementById('registerBox').style.display='none';
    document.getElementById('loginBox').style.display='block';
    document.getElementById('reviewBox').style.display='none';
}
function showRegisterBox(){
    document.getElementById('registerBox').style.display='block';
    document.getElementById('loginBox').style.display='none';
    document.getElementById('reviewBox').style.display='none';
}

// ---- 5. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ----
function registerUser(){
    const name = document.getElementById('regUsername').value.trim();
    const pass1 = document.getElementById('regPassword').value;
    const pass2 = document.getElementById('regPassword2').value;
    const fileInput = document.getElementById('regAvatar');

    if(!name || !pass1 || !pass2) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
    if(pass1 !== pass2) return alert("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç");
    if(users.some(u => u.name === name)) return alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
    if(!fileInput.files[0]) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä");

    const reader = new FileReader();
    reader.onload = function(e){
        const avatarBase64 = e.target.result;
        const newUser = {name:name, password:pass1, avatar:avatarBase64, role:"user"};
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        currentUser = newUser;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showReviewBox();
    }
    reader.readAsDataURL(fileInput.files[0]);
}

// ---- 6. –í—Ö–æ–¥ ----
function loginUser(){
    const name = document.getElementById('loginUsername').value.trim();
    const pass = document.getElementById('loginPassword').value;

    const user = users.find(u => u.name === name && u.password === pass);
    if(!user) return alert("–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å");

    currentUser = user;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    showReviewBox();
}

// ---- 7. –í—ã—Ö–æ–¥ ----
function logoutUser(){
    currentUser = null;
    localStorage.removeItem('currentUser');
    showLoginBox();
}

// ---- 8. –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –æ—Ç–∑—ã–≤–æ–≤ ----
function showReviewBox(){
    document.getElementById('registerBox').style.display='none';
    document.getElementById('loginBox').style.display='none';
    document.getElementById('reviewBox').style.display='block';
    document.getElementById('userDisplay').innerText = currentUser.name;
    document.getElementById('userAvatar').src = currentUser.avatar;

    document.getElementById('changeAvatarBtn').style.display = currentUser.role === "user" ? "inline-block" : "none";
    showReviews();
}

// ---- 9. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ user) ----
function changeAvatar(){
    if(currentUser.role !== "user") return;
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = e => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(ev){
            currentUser.avatar = ev.target.result;
            const idx = users.findIndex(u => u.name === currentUser.name);
            users[idx].avatar = currentUser.avatar;
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            document.getElementById('userAvatar').src = currentUser.avatar;
            showReviews();
        }
        reader.readAsDataURL(file);
    }
    input.click();
}

// ---- 10. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ —Å –∞–Ω—Ç–∏-—Ç–æ–∫—Å–∏–∫–æ–º ----

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω—Ç–∏-—Ç–æ–∫—Å–∏–∫–∞
function cleanBadWords(text) {
    // –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª–æ–≤–∞, –≤–∫–ª—é—á–∞—è –∑–Ω–∞–∫–∏ –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞
    return text.split(/(\s+)/).map(word => {
        // —É–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–Ω–∞–∫–∏, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–æ–≤–æ
        const clean = word.toLowerCase().replace(/[^–∞-—è—ëa-z0-9]/gi, "");
        if (BAD_WORDS.includes(clean)) {
            return "*".repeat(word.length); // –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –∑–≤–µ–∑–¥—ã
        }
        return word;
    }).join("");
}


// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
function addReview() {
    const input = document.getElementById("reviewInput");
    let text = input.value.trim();
    if (!text) return;

    // –∞–Ω—Ç–∏-—Ç–æ–∫—Å–∏–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    if(currentUser.role !== "admin") {
        text = cleanBadWords(text);
    }

    const review = {
        id: Date.now(),
        name: currentUser.name,
        avatar: currentUser.avatar,
        text: text,
        likes: [],
        dislikes: [],
        role: currentUser.role
    };

    let reviews = JSON.parse(localStorage.getItem("reviews") || "[]");
    reviews.push(review);
    localStorage.setItem("reviews", JSON.stringify(reviews));

    input.value = "";
    showReviews();
}

// –ü–æ–∫–∞–∑ –æ—Ç–∑—ã–≤–æ–≤
function showReviews() {
    let reviews = JSON.parse(localStorage.getItem("reviews") || "[]");
    const div = document.getElementById("reviewsList");
    div.innerHTML = "";

    if(reviews.length === 0) {
        div.innerHTML = "<p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>";
        return;
    }

    reviews.forEach(r => {
        const canDelete = r.name === currentUser.name || (currentUser.role==="admin" && r.role==="user");
        const liked = r.likes.includes(currentUser.name);
        const disliked = r.dislikes.includes(currentUser.name);

        const reviewDiv = document.createElement("div");
        reviewDiv.style.border="1px solid #ccc";
        reviewDiv.style.padding="6px";
        reviewDiv.style.marginBottom="6px";
        reviewDiv.style.borderRadius="6px";
        reviewDiv.innerHTML = `
            <img src="${r.avatar}" style="width:40px;height:40px;border-radius:50%;vertical-align:middle;margin-right:6px;">
            <b>${r.name}:</b> ${r.text}<br>
            <button onclick="toggleLike(${r.id}, 'like')" style="background:${liked?'#8f8':'#eee'}">üëç ${r.likes.length}</button>
            <button onclick="toggleLike(${r.id}, 'dislike')" style="background:${disliked?'#f88':'#eee'}">üëé ${r.dislikes.length}</button>
        `;
        if(canDelete){
            const delBtn = document.createElement("button");
            delBtn.textContent = "–£–¥–∞–ª–∏—Ç—å";
            delBtn.style.background="red";
            delBtn.style.color="white";
            delBtn.style.marginLeft="10px";
            delBtn.onclick = () => deleteReview(r.id);
            reviewDiv.appendChild(delBtn);
        }
        div.appendChild(reviewDiv);
    });
}

// –õ–∞–π–∫–∏ –∏ –¥–∏–∑–ª–∞–π–∫–∏
function toggleLike(id,type){
    let reviews = JSON.parse(localStorage.getItem("reviews") || "[]");
    for(let r of reviews){
        if(r.id === id){
            if(type==="like"){
                r.dislikes = r.dislikes.filter(u=>u!==currentUser.name);
                if(r.likes.includes(currentUser.name)) r.likes = r.likes.filter(u=>u!==currentUser.name);
                else r.likes.push(currentUser.name);
            }
            if(type==="dislike"){
                r.likes = r.likes.filter(u=>u!==currentUser.name);
                if(r.dislikes.includes(currentUser.name)) r.dislikes = r.dislikes.filter(u=>u!==currentUser.name);
                else r.dislikes.push(currentUser.name);
            }
        }
    }
    localStorage.setItem("reviews", JSON.stringify(reviews));
    showReviews();
}

// –£–¥–∞–ª–µ–Ω–∏–µ
function deleteReview(id){
    let reviews = JSON.parse(localStorage.getItem("reviews") || "[]");
    reviews = reviews.filter(r => !(r.id===id && (r.name===currentUser.name || (currentUser.role==="admin" && r.role==="user"))));
    localStorage.setItem("reviews", JSON.stringify(reviews));
    showReviews();
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
window.onload = showReviews;

// –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.onload = function() {
    if(currentUser) {
        document.getElementById('reviewBox').style.display='block';
        document.getElementById('userDisplay').innerText = currentUser.name;
        document.getElementById('userAvatar').src = currentUser.avatar;
    }
    showReviews();
}



// ---- 13. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–æ—à—ë–ª ----
if(currentUser) showReviewBox();

function toggleMail(){
    const box = document.getElementById("mailBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
    showMail();
}

function sendMail(){
    if(currentUser.role !== "admin") return;

    let to = document.getElementById("mailTo").value.trim();
    let text = document.getElementById("mailInput").value.trim();

    if(!to || !text) return alert("–ó–∞–ø–æ–ª–Ω–∏ —Ç–µ–∫—Å—Ç –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è");

    if(!users.some(u => u.name === to)) return alert("–¢–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç");

    let mails = JSON.parse(localStorage.getItem("mails") || "[]");

    mails.push({
        id: Date.now(),
        from: currentUser.name,
        to: to,
        text: text
    });

    localStorage.setItem("mails", JSON.stringify(mails));

    document.getElementById("mailTo").value = "";
    document.getElementById("mailInput").value = "";

    showMail();
}

function showMail(){
    const mails = JSON.parse(localStorage.getItem("mails") || "[]");
    const list = document.getElementById("mailList");

    let visible = [];

    if(currentUser.role === "admin"){
        visible = mails; // –∞–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –ø–∏—Å—å–º–∞
    } else {
        visible = mails.filter(m => m.to === currentUser.name); // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
    }

    list.innerHTML = ""; // –æ—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π

    if(visible.length === 0){
        list.innerHTML = "<p>–ü–∏—Å–µ–º –Ω–µ—Ç</p>";
        return;
    }

    for(let m of visible){
        const div = document.createElement("div");
        div.style.background = "#eee";
        div.style.padding = "8px";
        div.style.marginBottom = "6px";
        div.style.borderRadius = "6px";

        // –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –ø–∏—Å—å–º–∞ ‚Äî —Ç–µ–∫—É—â–∏–π –∞–¥–º–∏–Ω
        let deleteBtn = "";
        if(currentUser.role === "admin" && m.from === currentUser.name){
            deleteBtn = document.createElement("button");
            deleteBtn.textContent = "–£–¥–∞–ª–∏—Ç—å";
            deleteBtn.style.background = "red";
            deleteBtn.style.color = "white";
            deleteBtn.style.marginLeft = "10px";
            deleteBtn.onclick = () => deleteMail(m.id);
            div.appendChild(deleteBtn);
        }

        // —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å—å–º–∞
        const content = document.createElement("div");
        content.innerHTML = `<b>${m.from} ‚Üí ${m.to}</b><br>${m.text}`;
        div.insertBefore(content, div.firstChild);

        list.appendChild(div);
    }

    // —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    document.getElementById("adminMailForm").style.display =
        currentUser.role === "admin" ? "block" : "none";
}


function deleteMail(id){
    let mails = JSON.parse(localStorage.getItem("mails") || "[]");

    // –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–∏—Å—å–º–∞, –≥–¥–µ id –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–ª–∏ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –¥—Ä—É–≥–∏–º –∞–¥–º–∏–Ω–æ–º
    mails = mails.filter(m => m.id !== id || m.from !== currentUser.name);

    localStorage.setItem("mails", JSON.stringify(mails));
    showMail();
}

function toggleLike(reviewId, type){
    let reviews = JSON.parse(localStorage.getItem("reviews") || "[]");

    for(let r of reviews){
        if(r.id === reviewId){
            // —É–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é
            if(type === "like"){
                r.dislikes = r.dislikes.filter(u => u !== currentUser.name);
                if(r.likes.includes(currentUser.name)){
                    r.likes = r.likes.filter(u => u !== currentUser.name);
                } else {
                    r.likes.push(currentUser.name);
                }
            }

            if(type === "dislike"){
                r.likes = r.likes.filter(u => u !== currentUser.name);
                if(r.dislikes.includes(currentUser.name)){
                    r.dislikes = r.dislikes.filter(u => u !== currentUser.name);
                } else {
                    r.dislikes.push(currentUser.name);
                }
            }
        }
    }

    localStorage.setItem("reviews", JSON.stringify(reviews));
    showReviews();
}

if(currentUser){
    showReviewBox();
} else {
    showLoginBox();
}


</script>

</div>
</body>
</html>
